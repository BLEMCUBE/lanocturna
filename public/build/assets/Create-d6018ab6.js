import{l as se,K as S,T as R,k as D,F as A,h as ae,m as x,A as le,f as v,a as l,u as s,w as m,p as $,o as w,Z as ne,b as e,t as r,e as j,L as de,Q as re,s as ie,v as g,n as P,d as f,C as _,D as V,O as q}from"./app-da52df30.js";import{_ as ce}from"./AppLayout-ad6a5584.js";import{a as h,_ as i}from"./InputLabel-6e5e15c8.js";import{s as pe}from"./multiselect-e0a12eff.js";import{S as ue}from"./sweetalert2.all-e30d0676.js";import"./logo-e22dfca4.js";import"./_plugin-vue_export-helper-c27b6911.js";const me={class:"grid grid-cols-12 p-0 m-0 gap-2 mb-4 bg-white col-span-12 py-2 rounded-lg shadow-lg lg:col-span-12 dark:border-gray-700 dark:bg-gray-800"},xe={class:"mt-0 mb-4 col-span-12 lg:col-span-8"},be=["onSubmit"],ge={class:"grid grid-cols-12 gap-1 py-0"},fe={class:"table-auto mx-2 border border-gray-300 col-span-12"},_e=e("thead",null,[e("tr",{class:"p-2 bg-secondary-900 border"},[e("th",{class:"border border-gray-300 p-2 w-24"},"Origen"),e("th",{class:"border border-gray-300"},"Producto"),e("th",{class:"border border-gray-300 w-24"},"Cantidad"),e("th",{class:"border border-gray-300 w-24"},"Precio"),e("th",{class:"border border-gray-300 w-24"},"Total"),e("th",{class:"border border-gray-300 w-8"})])],-1),he={class:"border border-gray-300 p-2"},ye={class:"border border-gray-300 p-2"},ve={class:"border border-gray-300"},we=["onUpdate:modelValue","onInput"],Ve={class:"border border-gray-300"},ke=["onUpdate:modelValue","onInput"],Te={class:"border border-gray-300 p-2"},Ce={class:"border-none border-gray-300"},Fe={class:"rounded-none flex justify-center items-center bg-red-600 py-auto text-base font-semibold text-white hover:bg-red-700"},Ue=["onClick"],Se=e("i",{class:"fas fa-trash"},null,-1),De=[Se],je=e("td",{colspan:"4",class:"text-end"},[e("b",null,"Subtotal: ")],-1),Ie={class:"text-end"},Me=e("td",{colspan:"4",class:"text-end"},[e("b",null,"Total (con impuestos): ")],-1),Ne={class:"text-end"},Oe={class:"col-span-12 p-2 xl:col-span-12"},Ee=e("div",{class:"px-0 py-1 m-2 bg-primary-900 text-white col-span-full flex justify-center items-center"},[e("h5",{class:"text-lg font-medium"},"Datos venta")],-1),ze={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},Re={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},Ae={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},$e={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},Pe={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},qe={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},Be={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},Le={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},Ge={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-12"},He={class:"flex justify-end py-3"},Ke={class:"p-0 mb-0 col-span-12 lg:col-span-4"},Qe={class:"flex justify-content-end text-sm"},We={class:"w-full mx-auto px-1"},Ze={class:"flex flex-col gap-y-1 mx-2 sm:flex-row sm:items-center sm:justify-between"},Je={class:"flex items-center"},Xe=["src"],Ye={class:"ml-6 w-auto text-start"},et={class:"text-gray-800 mb-2 text-xs whitespace-pre-line font-bold leading-1"},tt={class:"font-bold leading-none text-xs text-gray-800 pb-1"},ot={class:"px-1 py-0 font-normal"},st={class:"font-bold leading-none text-xs text-gray-800"},at={class:"px-1 py-0 font-normal"},lt={class:""},nt=["onSubmit"],dt={class:"px-2 grid grid-cols-6 gap-4 md:gap-3 2xl:gap-6 mb-2"},rt={class:"col-span-6 shadow-default xl:col-span-6"},it={class:"flex items-center"},ct=["src"],pt={class:"ml-6 text-start"},ut={class:"text-gray-800 mb-2 text-xs whitespace-pre-line font-bold leading-1"},mt={class:"font-bold leading-none text-xs text-gray-800 pb-1"},xt={class:"px-1 py-0 font-normal"},bt={class:"col-span-6 shadow-default xl:col-span-6"},gt={class:"col-span-6 shadow-default xl:col-span-6"},ft={class:"flex justify-end py-3"},I="Venta",k="ventas",Ct={__name:"Create",setup(_t){const B=se(),{vendedor:T}=S().props,{lista_destinos:M}=S().props,d=R({producto_id:"",nombre:"",origen:"",imagen:"",cantidad:1,precio:1}),C=D({global:{value:null,matchMode:A.STARTS_WITH},origen:{value:null,matchMode:A.CONTAINS}}),L=n=>{M.find(o=>o.value===n),t.destino=n},t=R({vendedor_id:"",destino:"",total:0,neto:0,estado:"PENDIENTE A FACTURACION",impuesto:"",porcentaje_impuesto:"",observaciones:"",productos:[],cliente:{nombre:"",direccion:""}}),F=D(!1),{productos:N}=S().props,O=D({value:"",closeOnSelect:!0,placeholder:"Seleccione",searchable:!1,options:[]});ae(()=>{O.value.options=M});const G=n=>{var o=N.data.find(b=>b.id===n);o.stock>0?(t.productos.push({producto_id:o.id,nombre:o.nombre,origen:o.origen,cantidad:1,precio:1,stock:o.stock,total:1 .toFixed(2)*1 .toFixed(2)}),U(),y()):z("No hay stock disponible","error")},H=()=>{F.value=!1,d.reset()},K=()=>{t.productos.push({producto_id:d.producto_id,nombre:d.nombre,cantidad:d.cantidad.toFixed(2),precio:d.precio.toFixed(2),total:d.cantidad.toFixed(2)*d.precio.toFixed(2)})},U=()=>{t.neto=t.productos.reduce((n,o)=>n+parseFloat(o.total),0).toFixed(2),y(),t.impuesto=(t.total-t.neto).toFixed(2)},Q=n=>{t.productos.splice(n,1),U(),y()},y=()=>{t.total=(t.neto*1.22).toFixed(2)},E=(n,o)=>{if(n.target.value>0)t.productos[o].stock>=t.productos[o].cantidad?(t.productos[o].total=(parseFloat(t.productos[o].cantidad)*parseFloat(t.productos[o].precio)).toFixed(2),U(),y()):(t.productos[o].cantidad=1,t.productos[o].total=(parseFloat(t.productos[o].cantidad)*parseFloat(t.productos[o].precio)).toFixed(2),z("La cantidad supera el Stock","error"));else return},W=()=>{t.clearErrors(),t.post(route(k+".store"),{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{Z("success","Mensaje","Venta creada"),setTimeout(()=>{q.get(route(k+".index"))},1e3)},onFinish:()=>{},onError:()=>{}})},z=(n,o)=>{ue.fire({width:350,title:n,icon:o})},Z=(n,o,b)=>{B.add({severity:n,summary:o,detail:b,life:3e3})},J=()=>{q.get(route(k+".index"))};return(n,o)=>{const b=x("Toast"),c=x("InputText"),X=x("Textarea"),Y=x("Column"),ee=x("DataTable"),te=x("Dialog"),oe=le("tooltip");return w(),v($,null,[l(s(ne),{title:I}),l(ce,{pagina:[{label:"Ventas",link:!0,url:n.route(k+".index")},{label:I,link:!1}]},{default:m(()=>[e("div",me,[l(b),e("div",xe,[e("div",{class:"px-0 py-1 m-2 mt-0 bg-primary-900 text-white col-span-full flex justify-center items-center"},[e("h5",{class:"text-2xl font-medium"},r(I))]),e("form",{onSubmit:j(W,["prevent"])},[e("div",ge,[e("table",fe,[_e,e("tbody",null,[(w(!0),v($,null,de(s(t).productos,(a,u)=>(w(),v("tr",{key:u,class:"font-sans font-normal text-gray-800 border border-gray-300"},[e("td",he,r(a.origen),1),e("td",ye,r(a.nombre),1),e("td",ve,[_(e("input",{type:"number",required:"","onUpdate:modelValue":p=>a.cantidad=p,min:"1",step:"0.1",class:"p-inputtext p-component font-sans font-normal text-gray-700 bg-white border-0 appearance-none rounded-none text-sm px-2 py-0 p-inputnumber-input h-9 px-0 py-0 m-0 w-full text-end text-sm",onInput:p=>E(p,u)},null,40,we),[[V,a.cantidad]])]),e("td",Ve,[_(e("input",{type:"number",required:"","onUpdate:modelValue":p=>a.precio=p,min:"1",step:"0.1",onInput:p=>E(p,u),class:"p-inputtext p-component font-sans font-normal text-gray-700 bg-white border-0 appearance-none rounded-none text-sm px-2 py-0 p-inputnumber-input h-9 px-0 py-0 m-0 w-full text-end text-sm"},null,40,ke),[[V,a.precio]])]),e("td",Te,r(a.total),1),e("td",Ce,[e("div",Fe,[_((w(),v("button",{onClick:j(p=>Q(u),["prevent"]),class:"w-6"},De,8,Ue)),[[oe,{value:"Eliminar",pt:{text:"bg-gray-500 p-1 m-0 text-xs text-white rounded"}},void 0,{top:!0}]])])])]))),128))]),e("tfoot",null,[e("tr",null,[je,e("td",Ie,[e("b",null,r(s(t).neto),1)])]),e("tr",null,[Me,e("td",Ne,[e("b",null,r(s(t).total),1)])])])]),e("div",Oe,[l(h,{class:"mt-1 text-xs w-full",message:s(t).errors.productos},null,8,["message"])]),Ee,e("div",ze,[l(i,{for:"vendedor",value:"Vendedor",class:"text-base font-medium leading-1 text-gray-900"}),l(c,{type:"text",id:"nro_carpeta",modelValue:s(T),"onUpdate:modelValue":o[0]||(o[0]=a=>re(T)?T.value=a:null),readonly:"",pt:{root:{class:"h-9 w-full"}}},null,8,["modelValue"]),l(h,{class:"mt-1 text-xs",message:s(t).errors.vendedor_id},null,8,["message"])]),e("div",Re,[l(i,{for:"destino",value:"Destino",class:"text-base font-medium leading-1 text-gray-900"}),l(s(pe),ie({id:"rol",modelValue:s(t).destino,"onUpdate:modelValue":o[1]||(o[1]=a=>s(t).destino=a)},O.value,{onSelect:L}),null,16,["modelValue"]),l(h,{class:"mt-1 text-xs",message:s(t).errors.destino},null,8,["message"])]),e("div",Ae,[l(i,{for:"cliente",value:"Cliente",class:"text-base font-medium leading-6 text-gray-900"}),l(c,{type:"text",id:"cliente",modelValue:s(t).cliente.nombre,"onUpdate:modelValue":o[2]||(o[2]=a=>s(t).cliente.nombre=a),placeholder:"ingrese nombre cliente",pt:{root:{class:"h-9 w-full"}}},null,8,["modelValue"]),l(h,{class:"mt-1 text-xs",message:s(t).errors["cliente.nombre"]},null,8,["message"])]),e("div",$e,[l(i,{for:"telefono",value:"Telefono",class:"text-base font-medium leading-6 text-gray-900"}),l(c,{type:"text",id:"telefono",modelValue:s(t).cliente.telefono,"onUpdate:modelValue":o[3]||(o[3]=a=>s(t).cliente.telefono=a),placeholder:"ingrese telefono",pt:{root:{class:"h-9 w-full"}}},null,8,["modelValue"])]),e("div",Pe,[l(i,{for:"localidad",value:"Localidad",class:"text-base font-medium leading-6 text-gray-900"}),l(c,{type:"text",id:"localidad",modelValue:s(t).cliente.localidad,"onUpdate:modelValue":o[4]||(o[4]=a=>s(t).cliente.localidad=a),placeholder:"ingrese localidad",pt:{root:{class:"h-9 w-full"}}},null,8,["modelValue"])]),e("div",qe,[l(i,{for:"direccion",value:"DirecciÃ³n",class:"text-base font-medium leading-6 text-gray-900"}),l(c,{type:"text",id:"direccion",modelValue:s(t).cliente.direccion,"onUpdate:modelValue":o[5]||(o[5]=a=>s(t).cliente.direccion=a),placeholder:"ingrese direccion",pt:{root:{class:"h-9 w-full"}}},null,8,["modelValue"]),l(h,{class:"mt-1 text-xs",message:s(t).errors["cliente.direccion"]},null,8,["message"])]),e("div",Be,[l(i,{for:"empresa",value:"Empresa",class:"text-base font-medium leading-6 text-gray-900"}),l(c,{type:"text",id:"empresa",modelValue:s(t).cliente.empresa,"onUpdate:modelValue":o[6]||(o[6]=a=>s(t).cliente.empresa=a),placeholder:"ingrese Empresa",pt:{root:{class:"h-9 w-full"}}},null,8,["modelValue"])]),e("div",Le,[l(i,{for:"rut",value:"RUT",class:"text-base font-medium leading-6 text-gray-900"}),l(c,{type:"text",id:"rut",modelValue:s(t).cliente.rut,"onUpdate:modelValue":o[7]||(o[7]=a=>s(t).cliente.rut=a),placeholder:"ingrese RUT",pt:{root:{class:"h-9 w-full"}}},null,8,["modelValue"])]),e("div",Ge,[l(i,{for:"rut",value:"Observaciones:",class:"text-base font-medium leading-6 text-gray-900"}),l(X,{modelValue:s(t).observaciones,"onUpdate:modelValue":o[8]||(o[8]=a=>s(t).observaciones=a),pt:{root:{rows:"1",class:"w-full"}}},null,8,["modelValue"])])]),e("div",He,[l(s(g),{label:"Cancelar",pt:{root:"mr-5"},severity:"danger",size:"small",onClick:J,type:"button"}),l(s(g),{label:"Guardar",size:"small",type:"submit",class:P({"opacity-50":s(t).processing}),disabled:s(t).processing},null,8,["class","disabled"])])],40,be)]),e("div",Ke,[l(ee,{showGridlines:"",filters:C.value,scrollable:"",scrollHeight:"400px",resizableColumns:"",globalFilterFields:["origen","nombre"],columnResizeMode:"fit",value:s(N).data,paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],size:"small"},{header:m(()=>[e("div",Qe,[l(c,{modelValue:C.value.global.value,"onUpdate:modelValue":o[9]||(o[9]=a=>C.value.global.value=a),placeholder:"Buscar"},null,8,["modelValue"])])]),empty:m(()=>[f(" No existe Resultado ")]),loading:m(()=>[f(" Cargando... ")]),default:m(()=>[l(Y,{field:"nombre",header:"",pt:{bodyCell:{class:"flex justify-start text-center p-0 mx-0"}}},{body:m(a=>[e("div",We,[e("div",Ze,[e("div",Je,[e("img",{class:"h-10 w-10 rounded-full object-cover",src:a.data.imagen,alt:""},null,8,Xe),e("div",Ye,[e("p",et,r(a.data.nombre),1),e("div",tt,[f("Origen: "),e("span",ot,r(a.data.origen),1)]),e("div",st,[f("Stock :"),e("span",at,r(a.data.stock),1)])])]),e("div",lt,[l(s(g),{severity:"success",onClick:u=>G(a.data.id),icon:"fas fa-cart-plus",pt:{root:{class:"flex items-center justify-center font-medium w-full"}},disabled:s(t).productos.filter(u=>u.producto_id===a.data.id).length>0},null,8,["onClick","disabled"])])])])]),_:1})]),_:1},8,["filters","value"])])]),l(te,{visible:F.value,"onUpdate:visible":o[12]||(o[12]=a=>F.value=a),modal:"",header:"Producto",style:{width:"65vw"},breakpoints:{"960px":"75vw","641px":"100vw"},position:"top",pt:{header:{class:"mt-6 p-2 lg:p-2 lg:bg-gray-100"},content:{class:"p-2 lg:p-2"}}},{default:m(()=>[e("form",{onSubmit:j(K,["prevent"])},[e("div",dt,[e("div",rt,[e("div",it,[e("img",{class:"h-10 w-10 rounded-full object-cover",src:s(d).imagen,alt:""},null,8,ct),e("div",pt,[e("p",ut,r(s(d).nombre),1),e("div",mt,[f(" Origen: "),e("span",xt,r(s(d).origen),1)])])])]),e("div",bt,[l(i,{for:"cantidad",value:"Cantidad",class:"text-base font-medium leading-6 text-gray-900"}),_(e("input",{type:"number",required:"","onUpdate:modelValue":o[10]||(o[10]=a=>s(d).cantidad=a),min:"1",step:"0.1",class:"p-inputtext p-component font-sans font-normal text-gray-700 dark:text-white/80 bg-white dark:bg-gray-900 border border-gray-300 dark:border-blue-900/40 transition-colors duration-200 appearance-none rounded-md text-sm px-2 py-1 p-inputnumber-input h-9 px-0 py-0 m-0 w-full text-end text-base"},null,512),[[V,s(d).cantidad]])]),e("div",gt,[l(i,{for:"precio",value:"Precio",class:"text-base font-medium leading-6 text-gray-900"}),_(e("input",{type:"number",required:"","onUpdate:modelValue":o[11]||(o[11]=a=>s(d).precio=a),min:"1",step:"0.1",class:"p-inputtext p-component font-sans font-normal text-gray-700 dark:text-white/80 bg-white dark:bg-gray-900 border border-gray-300 dark:border-blue-900/40 transition-colors duration-200 appearance-none rounded-md text-sm px-2 py-1 p-inputnumber-input h-9 px-0 py-0 m-0 w-full text-end text-base"},null,512),[[V,s(d).precio]])])]),e("div",ft,[l(s(g),{label:"Cancelar",pt:{root:"mr-5"},severity:"danger",size:"small",onClick:H,type:"button"}),l(s(g),{label:"Guardar",size:"small",type:"submit",class:P({"opacity-50":s(t).processing}),disabled:s(t).processing},null,8,["class","disabled"])])],40,nt)]),_:1},8,["visible"])]),_:1},8,["pagina"])],64)}}};export{Ct as default};
