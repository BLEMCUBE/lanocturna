import{k as J,K as w,T as N,l as g,F as Q,h as W,m as x,p as X,f as p,a as r,u as a,w as u,q as f,o as i,Z as Y,b as e,t as d,s as k,v as F,x as ee,e as C,c as te,y as oe,z as S,n as se,d as m,E as ae,O as M}from"./app-af39d278.js";import{_ as le,S as re}from"./AppLayout-f8d0aae8.js";import{_ as v}from"./InputError-7d6e7861.js";import{_ as I}from"./InputLabel-f920c230.js";import{s as ne}from"./multiselect-807ac887.js";import"./logo-e22dfca4.js";import"./_plugin-vue_export-helper-c27b6911.js";const ce={class:"grid grid-cols-12 p-0 m-0 gap-2 mb-4 bg-white col-span-12 py-2 rounded-lg shadow-lg lg:col-span-12 dark:border-gray-700 dark:bg-gray-800"},ie={class:"mt-0 mb-4 col-span-12 lg:col-span-8"},de={class:"grid grid-cols-12 gap-1 py-0"},pe={class:"table-auto mx-2 border border-gray-300 col-span-12"},ue=e("thead",null,[e("tr",{class:"p-2 bg-secondary-900 border"},[e("th",{class:"border border-gray-300 p-2 w-24"},"Origen"),e("th",{class:"border border-gray-300"},"Producto"),e("th",{class:"border border-gray-300 w-24"},"Cantidad"),e("th",{class:"border border-gray-300 w-8"})])],-1),me={class:"border border-gray-300 p-2"},_e={class:"border border-gray-300 p-2"},be={class:"border border-gray-300"},ge=["onUpdate:modelValue","onInput"],xe={class:"border-none border-gray-300 p-1"},fe={class:"rounded-md p-1 flex justify-center items-center bg-red-600 py-auto text-base font-semibold text-white hover:bg-red-700"},ve=["onClick"],he=e("i",{class:"fas fa-trash"},null,-1),ye=[he],we={class:"col-span-12 p-2 xl:col-span-12"},ke=e("div",{class:"px-0 py-1 m-2 bg-primary-900 text-white col-span-full flex justify-center items-center"},[e("h5",{class:"text-lg font-medium"},"Datos venta")],-1),Fe={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},Ce={class:"col-span-12 mx-2 py-0 shadow-default xl:col-span-6"},Se={class:"flex justify-end py-3"},Te={class:"p-0 mb-0 col-span-12 lg:col-span-4"},Ve={class:"flex justify-content-end text-sm"},De={class:"w-full mx-auto px-1"},je={class:"flex flex-col gap-y-1 mx-2 sm:flex-row sm:items-center sm:justify-between"},Ee={class:"flex items-center"},Oe=["src"],Ne={class:"ml-6 w-auto text-start"},Me={class:"text-gray-800 mb-2 text-xs whitespace-pre-line font-bold leading-1"},Ie={class:"font-bold leading-none text-xs text-gray-800 pb-1"},ze={class:"px-1 py-0 font-normal"},Ue={class:"font-bold leading-none text-xs text-gray-800"},$e={class:"px-1 py-0 font-normal"},Be={class:"leading-none text-xs text-gray-800"},Ae=e("b",{class:"text-xs leading-2 mt-0 text-gray-700 dark:text-gray-300"}," En camino: ",-1),Pe={class:"list-disc list-outside"},Le={class:"ml-3"},Re={class:"px-auto"},T="Mercado Libre",z="envios",Xe={__name:"Create",setup(qe){const U=J(),{tipo_cambio:$}=w().props,{lista_destinos:V}=w().props;N({producto_id:"",nombre:"",origen:"",imagen:"",cantidad:"",precio_sin_iva:"",precio:"",total_sin_iva:"",total:""});const h=g({global:{value:null,matchMode:Q.CONTAINS}}),B=l=>{V.find(o=>o.value===l),t.destino=l},t=N({vendedor_id:"",destino:"",total:0,total_sin_iva:0,moneda:"Pesos",tipo:"ENVIO",nro_compra:"",tipo_cambio:"",estado:"FACTURADO",observaciones:"",productos:[],cliente:{nombre:"",direccion:""}});g(!1);const{productos:D}=w().props,j=g({value:"",closeOnSelect:!0,placeholder:"Seleccione",searchable:!1,options:[]});g({value:"Pesos",closeOnSelect:!0,placeholder:"Seleccione",searchable:!1,options:[{value:"Pesos",label:"Pesos"},{value:"Dólares",label:"Dólares"}]}),W(()=>{j.value.options=V,t.tipo_cambio=$,t.moneda="Pesos"});const A=l=>{t.clearErrors();var o=D.data.find(c=>c.id===l);o.stock>0?(t.productos.push({producto_id:o.id,nombre:o.nombre,origen:o.origen,cantidad:1,precio:null,stock:o.stock,total:1}),y(),_()):E("No hay stock disponible","error")},y=()=>{t.total=t.productos.reduce((l,o)=>l+parseFloat(o.total),0).toFixed(2),t.total_sin_iva=t.productos.reduce((l,o)=>l+parseFloat(o.total_sin_iva),0).toFixed(2),_()},P=l=>{t.productos.splice(l,1),y(),_()},_=()=>{t.total_sin_iva=(t.total/1.22).toFixed(2)},L=(l,o)=>{var c=t.productos[o].precio===null?1:t.productos[o].precio;if(l.target.value>0)t.productos[o].stock>=t.productos[o].cantidad?(t.productos[o].total=parseFloat(t.productos[o].cantidad)*parseFloat(c).toFixed(2),t.productos[o].total_sin_iva=parseFloat(t.productos[o].cantidad)*parseFloat(c/1.22).toFixed(2),t.productos[o].precio_sin_iva=(t.productos[o].precio/1.22).toFixed(2),y(),_()):(t.productos[o].cantidad=1,t.productos[o].precio_sin_iva=t.productos[o].precio/1.22,t.productos[o].total=parseFloat(t.productos[o].cantidad)*parseFloat(c).toFixed(2),E("La cantidad supera el Stock","error"));else return},R=()=>{t.clearErrors(),t.post(route(z+".store"),{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{q("success","Mensaje","Envio creado"),setTimeout(()=>{M.get(route(z+".create"))},1e3)},onFinish:()=>{},onError:()=>{}})},E=(l,o)=>{re.fire({width:350,title:l,icon:o})},q=(l,o,c)=>{U.add({severity:l,summary:o,detail:c,life:3e3})},G=()=>{M.get(route("inicio"))};return(l,o)=>{const c=x("Toast"),O=x("InputText"),H=x("Column"),K=x("DataTable"),Z=X("tooltip");return i(),p(f,null,[r(a(Y),{title:T}),r(le,{pagina:[{label:T,link:!1}]},{default:u(()=>[e("div",ce,[r(c),e("div",ie,[e("div",{class:"px-0 py-1 m-2 mt-0 bg-primary-900 text-white col-span-full flex justify-center items-center"},[e("h5",{class:"text-2xl font-medium"},d(T))]),e("form",null,[e("div",de,[e("table",pe,[ue,e("tbody",null,[(i(!0),p(f,null,k(a(t).productos,(s,n)=>(i(),p("tr",{key:n,class:"font-sans font-normal text-gray-800 border border-gray-300"},[e("td",me,d(s.origen),1),e("td",_e,d(s.nombre),1),e("td",be,[F(e("input",{type:"number","onUpdate:modelValue":b=>s.cantidad=b,min:"1",step:"1",class:"p-inputtext p-component font-sans font-normal text-gray-700 bg-white border-0 appearance-none rounded-none text-sm px-2 py-0 p-inputnumber-input h-9 px-0 py-0 m-0 w-full text-end text-sm",onInput:C(b=>L(b,n),["prevent"])},null,40,ge),[[ee,s.cantidad]])]),e("td",xe,[e("div",fe,[F((i(),p("button",{type:"button",onClick:C(b=>P(n),["prevent"]),class:"w-6"},ye,8,ve)),[[Z,{value:"Eliminar",pt:{text:"bg-gray-500 p-1 m-0 text-xs text-white rounded"}},void 0,{top:!0}]])])])]))),128))])]),e("div",we,[r(v,{class:"mt-1 text-lg w-full",message:a(t).errors.productos},null,8,["message"]),(i(!0),p(f,null,k(a(t).errors.campos_productos,s=>(i(),te(v,{class:"mt-1 mb-0 text-lg",message:s},null,8,["message"]))),256))]),ke,e("div",Fe,[r(I,{for:"nro_compra",value:"Nro Compra",class:"text-base font-medium leading-6 text-gray-900"}),r(O,{type:"text",id:"nro_compra",modelValue:a(t).nro_compra,"onUpdate:modelValue":o[0]||(o[0]=s=>a(t).nro_compra=s),placeholder:"ingrese nro compra",pt:{root:{class:"h-9 w-full"}}},null,8,["modelValue"]),r(v,{class:"mt-1 text-xs",message:a(t).errors.nro_compra},null,8,["message"])]),e("div",Ce,[r(I,{for:"destino",value:"Destino",class:"text-base font-medium leading-1 text-gray-900"}),r(a(ne),oe({id:"rol",modelValue:a(t).destino,"onUpdate:modelValue":o[1]||(o[1]=s=>a(t).destino=s)},j.value,{onSelect:B}),null,16,["modelValue"]),r(v,{class:"mt-1 text-xs",message:a(t).errors.destino},null,8,["message"])])]),e("div",Se,[r(a(S),{label:"Cancelar",pt:{root:"mr-5 py-1"},severity:"danger",size:"small",onClick:G,type:"button"}),r(a(S),{label:"Guardar",size:"small",type:"button",class:se({"opacity-50":a(t).processing}),disabled:a(t).processing,onClick:C(R,["prevent"])},null,8,["class","disabled","onClick"])])])]),e("div",Te,[r(K,{filters:h.value,scrollable:"",scrollHeight:"550px",globalFilterFields:["origen","nombre"],value:a(D).data,virtualScrollerOptions:{itemSize:46},size:"small"},{header:u(()=>[e("div",Ve,[r(O,{modelValue:h.value.global.value,"onUpdate:modelValue":o[2]||(o[2]=s=>h.value.global.value=s),placeholder:"Buscar"},null,8,["modelValue"])])]),empty:u(()=>[m(" No existe Resultado ")]),loading:u(()=>[m(" Cargando... ")]),default:u(()=>[r(H,{field:"nombre",header:"Productos",pt:{bodyCell:{class:"flex justify-start text-center p-0 mx-0"}}},{body:u(s=>[e("div",De,[e("div",je,[e("div",Ee,[e("img",{class:"h-10 w-10 rounded-full object-cover",src:s.data.imagen,alt:""},null,8,Oe),e("div",Ne,[e("p",Me,d(s.data.nombre),1),e("div",Ie,[m("Origen: "),e("span",ze,d(s.data.origen),1)]),e("div",Ue,[m("Stock :"),e("span",$e,d(s.data.stock),1)]),e("div",Be,[Ae,e("ul",Pe,[(i(!0),p(f,null,k(s.data.importacion_detalles,n=>F((i(),p("li",Le,[e("p",null,[e("b",null,d(n.importacion.nro_carpeta),1),m(" : "+d(n.cantidad_total),1)])],512)),[[ae,n.importacion.estado=="En camino"]])),256))])])])]),e("div",Re,[r(a(S),{severity:"success","aria-label":"Add",onClick:n=>A(s.data.id),icon:"fas fa-cart-plus",pt:{root:{class:"flex items-center justify-center font-medium w-10"},label:{class:"hidden"}},disabled:a(t).productos.filter(n=>n.producto_id===s.data.id).length>0},null,8,["onClick","disabled"])])])])]),_:1})]),_:1},8,["filters","value"])])])]),_:1},8,["pagina"])],64)}}};export{Xe as default};
